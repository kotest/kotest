"use strict";(self.webpackChunkkotestdocs=self.webpackChunkkotestdocs||[]).push([[40305],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),l=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=l(n),u=a,h=m["".concat(p,".").concat(u)]||m[u]||d[u]||i;return n?o.createElement(h,r(r({ref:t},c),{},{components:n})):o.createElement(h,r({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},91965:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var o=n(87462),a=(n(67294),n(3905));const i={id:"spring",title:"Spring",sidebar_label:"Spring",slug:"spring.html"},r=void 0,s={unversionedId:"extensions/spring",id:"extensions/spring",title:"Spring",description:"Kotest offers a Spring extension that allows you to test code that uses the Spring framework for dependency injection.",source:"@site/docs/extensions/spring.md",sourceDirName:"extensions",slug:"/extensions/spring.html",permalink:"/docs/next/extensions/spring.html",draft:!1,editUrl:"https://github.com/kotest/kotest/blob/master/documentation/docs/extensions/spring.md",tags:[],version:"current",frontMatter:{id:"spring",title:"Spring",sidebar_label:"Spring",slug:"spring.html"},sidebar:"extensions",previous:{title:"Pitest",permalink:"/docs/next/extensions/pitest.html"},next:{title:"System Extensions",permalink:"/docs/next/extensions/system_extensions.html"}},p={},l=[{value:"Getting Started",id:"getting-started",level:2},{value:"Constructor Injection",id:"constructor-injection",level:2},{value:"Test Contexts",id:"test-contexts",level:2},{value:"Test Execution Events",id:"test-execution-events",level:2}],c={toc:l};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Kotest offers a Spring extension that allows you to test code that uses the Spring framework for dependency injection."),(0,a.kt)("h2",{id:"getting-started"},"Getting Started"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"If you prefer to see an example rather than read docs, then there is a sample project using spring\nwebflux ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kotest/kotest-examples/tree/master/kotest-spring-webflux"},"here"))),(0,a.kt)("p",null,"In order to use this extension, you need to add ",(0,a.kt)("inlineCode",{parentName:"p"},"io.kotest:kotest-extensions-spring")," module to your test compile path.\nThe latest version can always be found on maven\ncentral ",(0,a.kt)("a",{parentName:"p",href:"https://central.sonatype.com/artifact/io.kotest/kotest-extensions-spring"},"here"),"."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Since Kotest 6.0, all extensions are published under the ",(0,a.kt)("inlineCode",{parentName:"p"},"io.kotest")," group once again, with version cadence tied to\nmain Kotest releases.")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://central.sonatype.com/artifact/io.kotest/kotest-extensions-spring"},(0,a.kt)("img",{src:"https://img.shields.io/maven-central/v/io.kotest/kotest-extensions-spring.svg?label=latest%20release"})),"\n",(0,a.kt)("a",{parentName:"p",href:"https://central.sonatype.com/repository/maven-snapshots/io/kotest/kotest-extensions-spring/maven-metadata.xml"},(0,a.kt)("img",{src:"https://img.shields.io/maven-metadata/v?metadataUrl=https%3A%2F%2Fcentral.sonatype.com%2Frepository%2Fmaven-snapshots%2Fio%2Fkotest%2Fkotest-extensions-spring%2Fmaven-metadata.xml"}))),(0,a.kt)("p",null,"The Spring extension requires you to activate it for all spec classes, or per spec class. To activate it globally,\nyou can register the ",(0,a.kt)("inlineCode",{parentName:"p"},"SpringExtension")," in ",(0,a.kt)("a",{parentName:"p",href:"/docs/next/framework/project-config.html"},"project config"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"class ProjectConfig : AbstractProjectConfig() {\n  override val extensions = listOf(SpringExtension())\n}\n")),(0,a.kt)("p",null,"Alternatively, you can register the extension per spec class via the ",(0,a.kt)("inlineCode",{parentName:"p"},"@ApplyExtension")," annotation."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"@ApplyExtension(SpringExtension::class)\nclass MyTestSpec : FunSpec() {}\n")),(0,a.kt)("p",null,"In order to let Spring know which configuration class to use, you must annotate your Spec classes with\nSpring Test annotation such as ",(0,a.kt)("inlineCode",{parentName:"p"},"@Configuration"),". This should point to a class annotated with the Spring ",(0,a.kt)("inlineCode",{parentName:"p"},"@Configuration")," annotation.\nAlternatively, you can use ",(0,a.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-framework/reference/testing/annotations/integration-spring/annotation-activeprofiles.html"},(0,a.kt)("inlineCode",{parentName:"a"},"@ActiveProfiles")),"\nto point to\na ",(0,a.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html"},"specific application context file"),"."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"In Kotest 4.3 and earlier, the Spring extension was called ",(0,a.kt)("inlineCode",{parentName:"p"},"SpringListener"),". This extension has now been deprecated in\nfavour of ",(0,a.kt)("inlineCode",{parentName:"p"},"SpringExtension"),". The usage is the same, but the SpringExtension has more functionality.")),(0,a.kt)("h2",{id:"constructor-injection"},"Constructor Injection"),(0,a.kt)("p",null,"When the Spring extension is active, Kotest will automatically take care of instantating your test classes using the\nprimary constructor. This inclues autowiring constructor parameters."),(0,a.kt)("p",null,"The following example is a test class which requires a service called ",(0,a.kt)("inlineCode",{parentName:"p"},"UserService")," in its primary constructor. This\n",(0,a.kt)("inlineCode",{parentName:"p"},"UserService")," class is just a regular spring bean which has been annotated with @Component."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'@ContextConfiguration(classes = [(Components::class)])\nclass SpringAutowiredConstructorTest(service: UserService) : WordSpec() {\n  init {\n    "SpringExtension" should {\n      "have autowired the service" {\n        service.repository.findUser().name shouldBe "system_user"\n      }\n    }\n  }\n}\n')),(0,a.kt)("h2",{id:"test-contexts"},"Test Contexts"),(0,a.kt)("p",null,"The Spring extensions makes available the ",(0,a.kt)("inlineCode",{parentName:"p"},"TestContextManager")," via the coroutine context that tests execute in. You can\ngain a handle to this instance through the ",(0,a.kt)("inlineCode",{parentName:"p"},"testContextManager()")," extension method."),(0,a.kt)("p",null,"From this you can get the ",(0,a.kt)("inlineCode",{parentName:"p"},"testContext")," that Spring is using."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MySpec(service: UserService) : WordSpec() {\n  init {\n    "SpringExtension" should {\n      "provide the test context manager" {\n        println("The context is " + testContextManager().testContext)\n      }\n    }\n  }\n}\n')),(0,a.kt)("h2",{id:"test-execution-events"},"Test Execution Events"),(0,a.kt)("p",null,"Spring has\nvarious ",(0,a.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-framework/reference/testing/testcontext-framework/test-execution-events.html"},"Test Execution Events"),"\nsuch as ",(0,a.kt)("inlineCode",{parentName:"p"},"BeforeTestMethod")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"BeforeTestExecution"),". These events make an assumption that tests are methods, so they do\nnot map exactly one to one to tests defined in frameworks like Kotest where tests are functions and can be nested\narbitrarily."),(0,a.kt)("p",null,"You can customize when these callbacks are fired by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"SpringTestLifecycleMode")," enum when creating the\nextension. By default, this is on leaf tests. You can set these to fire on root tests by passing a\n",(0,a.kt)("inlineCode",{parentName:"p"},"SpringTestLifecycleMode.Root"),"\nargument to the extension:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"class ProjectConfig : AbstractProjectConfig() {\n  override val extensions = listOf(SpringExtension(SpringTestLifecycleMode.Root))\n}\n")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"If you want to use root mode with @ApplyExtension, you must use the ",(0,a.kt)("inlineCode",{parentName:"p"},"SpringRootTestExtension")," subclass, eg\n",(0,a.kt)("inlineCode",{parentName:"p"},"@ApplyExtension(SpringRootTestExtension::class)"),".\n::"),(0,a.kt)("h3",{parentName:"admonition",id:"order-of-events"},"Order of Events"),(0,a.kt)("p",{parentName:"admonition"},"Spring defines a precedence order for when callbacks are fired.\nThere are four events that can fire related to tests. These are"),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"BeforeTestMethodEvent")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"BeforeTestExecutionEvent")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"AfterTestExecutionEvent")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"AfterTestMethodEvent"))),(0,a.kt)("p",{parentName:"admonition"},"Spring requests that the ",(0,a.kt)("inlineCode",{parentName:"p"},"beforeTestMethod")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"afterTestMethod")," events be fired before other user callbacks, and that\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"beforeTestExecution")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"afterTestExecution")," events be fired after other user callbacks. It is not possible in\nKotest to define the order of callbacks, but we try to follow the request as closely as possible."),(0,a.kt)("p",{parentName:"admonition"},"Kotest executes these callbacks in the following groups, where the order between groups is guaranteed, but\nthe order inside any group is not guaranteed:"),(0,a.kt)("p",{parentName:"admonition"},"Group 1: Spring's ",(0,a.kt)("inlineCode",{parentName:"p"},"BeforeTestMethodEvent")," and any other ",(0,a.kt)("inlineCode",{parentName:"p"},"TestCaseExtension"),"s.\nGroup 2: Spring's ",(0,a.kt)("inlineCode",{parentName:"p"},"BeforeTestExecutionEvent")," and any other ",(0,a.kt)("inlineCode",{parentName:"p"},"BeforeTest"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"BeforeAny"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"BeforeEach")," callbacks.\nGroup 3: Spring's ",(0,a.kt)("inlineCode",{parentName:"p"},"AfterTestExecutionEvent")," and any other ",(0,a.kt)("inlineCode",{parentName:"p"},"AfterTest"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"AfterAny"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"AfterEach")," callbacks.\nGroup 4: Spring's ",(0,a.kt)("inlineCode",{parentName:"p"},"AfterTestMethodEvent")," and any other ",(0,a.kt)("inlineCode",{parentName:"p"},"TestCaseExtension"),"s."),(0,a.kt)("h2",{parentName:"admonition",id:"final-classes"},"Final Classes"),(0,a.kt)("p",{parentName:"admonition"},"When using a final class, you may receive a warning from Kotest:"),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"Using SpringExtension on a final class. If any Spring annotation fails to work, try making this class open")),(0,a.kt)("p",{parentName:"admonition"},"If you wish, you can disable this warning by setting the system property ",(0,a.kt)("inlineCode",{parentName:"p"},"kotest.listener.spring.ignore.warning")," to\ntrue.")))}d.isMDXComponent=!0}}]);