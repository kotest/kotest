"use strict";(self.webpackChunkkotestdocs=self.webpackChunkkotestdocs||[]).push([[86051],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var o=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,s=function(e,t){if(null==e)return{};var n,o,s={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,s=e.mdxType,i=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),m=p(n),d=s,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||i;return n?o.createElement(h,r(r({ref:t},c),{},{components:n})):o.createElement(h,r({ref:t},c))}));function d(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=n.length,r=new Array(i);r[0]=m;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:s,r[1]=a;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},20837:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>p});var o=n(87462),s=(n(67294),n(3905));const i={id:"spring",title:"Spring",sidebar_label:"Spring",slug:"spring.html"},r=void 0,a={unversionedId:"extensions/spring",id:"version-6.0/extensions/spring",title:"Spring",description:"Kotest offers a Spring extension that allows you to test code that uses the Spring framework for dependency injection.",source:"@site/versioned_docs/version-6.0/extensions/spring.md",sourceDirName:"extensions",slug:"/extensions/spring.html",permalink:"/docs/6.0/extensions/spring.html",draft:!1,editUrl:"https://github.com/kotest/kotest/blob/master/documentation/versioned_docs/version-6.0/extensions/spring.md",tags:[],version:"6.0",frontMatter:{id:"spring",title:"Spring",sidebar_label:"Spring",slug:"spring.html"},sidebar:"extensions",previous:{title:"Pitest",permalink:"/docs/6.0/extensions/pitest.html"},next:{title:"System Extensions",permalink:"/docs/6.0/extensions/system_extensions.html"}},l={},p=[{value:"Constructor Injection",id:"constructor-injection",level:3},{value:"TestContexts",id:"testcontexts",level:3},{value:"Test Method Callbacks",id:"test-method-callbacks",level:3},{value:"Final Classes",id:"final-classes",level:3}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,s.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Kotest offers a Spring extension that allows you to test code that uses the Spring framework for dependency injection."),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"If you prefer to see an example rather than read docs, then there is a sample project using spring webflux ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/kotest/kotest-examples/tree/master/kotest-spring-webflux"},"here"))),(0,s.kt)("p",null,"In order to use this extension, you need to add ",(0,s.kt)("inlineCode",{parentName:"p"},"io.kotest:kotest-extensions-spring")," module to your test compile path. The latest version can always be found on maven central ",(0,s.kt)("a",{parentName:"p",href:"https://central.sonatype.com/artifact/io.kotest/kotest-extensions-spring"},"here"),"."),(0,s.kt)("admonition",{type:"note"},(0,s.kt)("p",{parentName:"admonition"},"Since Kotest 6.0, all extensions are published under the ",(0,s.kt)("inlineCode",{parentName:"p"},"io.kotest")," group once again, with version cadence tied to\nmain Kotest releases.")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://central.sonatype.com/artifact/io.kotest/kotest-extensions-spring"},(0,s.kt)("img",{src:"https://img.shields.io/maven-central/v/io.kotest/kotest-extensions-spring.svg?label=latest%20release"})),"\n",(0,s.kt)("a",{parentName:"p",href:"https://central.sonatype.com/repository/maven-snapshots/io/kotest/kotest-extensions-spring/maven-metadata.xml"},(0,s.kt)("img",{src:"https://img.shields.io/maven-metadata/v?metadataUrl=https%3A%2F%2Fcentral.sonatype.com%2Frepository%2Fmaven-snapshots%2Fio%2Fkotest%2Fkotest-extensions-spring%2Fmaven-metadata.xml"}))),(0,s.kt)("p",null,"The Spring extension requires you to activate it for all test classes, or per test class. To activate it globally,\nregister the ",(0,s.kt)("inlineCode",{parentName:"p"},"SpringExtension")," in ",(0,s.kt)("a",{parentName:"p",href:"/docs/6.0/framework/project-config.html"},"project config"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},"package io.kotest.provided\n\nimport io.kotest.core.config.AbstractProjectConfig\nimport io.kotest.extensions.spring.SpringExtension\n\nclass ProjectConfig : AbstractProjectConfig() {\n   override val extensions = listOf(SpringExtension())\n}\n")),(0,s.kt)("p",null,"To activate it per test class:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},"import io.kotest.core.extensions.ApplyExtension\nimport io.kotest.extensions.spring.SpringExtension\n\n@ApplyExtension(SpringExtension::class)\nclass MyTestSpec : FunSpec() {}\n")),(0,s.kt)("p",null,"In order to let Spring know which configuration class to use, you must annotate your Spec classes with ",(0,s.kt)("inlineCode",{parentName:"p"},"@ContextConfiguration"),".\nThis should point to a class annotated with the Spring ",(0,s.kt)("inlineCode",{parentName:"p"},"@Configuration")," annotation. Alternatively, you can use\n",(0,s.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-framework/reference/testing/annotations/integration-spring/annotation-activeprofiles.html"},(0,s.kt)("inlineCode",{parentName:"a"},"@ActiveProfiles"))," to\npoint to a ",(0,s.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html"},"specific application context file"),"."),(0,s.kt)("admonition",{type:"note"},(0,s.kt)("p",{parentName:"admonition"},"In Kotest 4.3 and earlier, the Spring extension was called ",(0,s.kt)("inlineCode",{parentName:"p"},"SpringListener"),". This extension has now been deprecated in favour of ",(0,s.kt)("inlineCode",{parentName:"p"},"SpringExtension"),". The usage is the same, but the SpringExtension has more functionality.")),(0,s.kt)("h3",{id:"constructor-injection"},"Constructor Injection"),(0,s.kt)("p",null,"For constructor injection, Kotest automatically registers a ",(0,s.kt)("inlineCode",{parentName:"p"},"SpringAutowireConstructorExtension"),"\nwhen the spring module is added to the build, assuming auto scan is enabled (see ",(0,s.kt)("a",{parentName:"p",href:"../framework/project-config.html"},"Project Config"),"). If Auto scan is\ndisabled, you will need to manually load the extension in your Project config."),(0,s.kt)("p",null,"This extension will intercept each call to create a Spec instance\nand will autowire the beans declared in the primary constructor."),(0,s.kt)("p",null,"The following example is a test class which requires a service called ",(0,s.kt)("inlineCode",{parentName:"p"},"UserService")," in its primary constructor. This service\nclass is just a regular spring bean which has been annotated with @Component."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},'@ContextConfiguration(classes = [(Components::class)])\nclass SpringAutowiredConstructorTest(service: UserService) : WordSpec() {\n  init {\n    "SpringExtension" should {\n      "have autowired the service" {\n        service.repository.findUser().name shouldBe "system_user"\n      }\n    }\n  }\n}\n')),(0,s.kt)("h3",{id:"testcontexts"},"TestContexts"),(0,s.kt)("p",null,"The Spring extensions makes available the ",(0,s.kt)("inlineCode",{parentName:"p"},"TestContextManager")," via the coroutine context that tests execute in. You can\ngain a handle to this instance through the ",(0,s.kt)("inlineCode",{parentName:"p"},"testContextManager()")," extension method."),(0,s.kt)("p",null,"From this you can get the ",(0,s.kt)("inlineCode",{parentName:"p"},"testContext")," that Spring is using."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MySpec(service: UserService) : WordSpec() {\n  init {\n    "SpringExtension" should {\n      "provide the test context manager" {\n         println("The context is " + testContextManager().testContext)\n      }\n    }\n  }\n}\n')),(0,s.kt)("h3",{id:"test-method-callbacks"},"Test Method Callbacks"),(0,s.kt)("p",null,"Spring has various test callbacks such as ",(0,s.kt)("inlineCode",{parentName:"p"},"beforeTestMethod")," that are based around the idea that tests are methods.\nThis assumption is fine for legacy test frameworks like JUnit but not applicable to modern test frameworks like Kotest where tests are functions."),(0,s.kt)("p",null,"Therefore, when using a ",(0,s.kt)("a",{parentName:"p",href:"/docs/6.0/framework/testing-styles.html"},"spec style")," that is nested, you can customize when the test method callbacks are fired.\nBy default, this is on the leaf node. You can set these to fire on the root nodes by passing a SpringTestLifecycleMode argument to the extension:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},"class ProjectConfig : AbstractProjectConfig() {\n   override val extensions = listOf(SpringExtension(SpringTestLifecycleMode.Root))\n}\n")),(0,s.kt)("h3",{id:"final-classes"},"Final Classes"),(0,s.kt)("p",null,"When using a final class, you may receive a warning from Kotest:"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"Using SpringListener on a final class. If any Spring annotation fails to work, try making this class open")),(0,s.kt)("p",null,"If you wish, you can disable this warning by setting the system property ",(0,s.kt)("inlineCode",{parentName:"p"},"kotest.listener.spring.ignore.warning")," to true."))}u.isMDXComponent=!0}}]);