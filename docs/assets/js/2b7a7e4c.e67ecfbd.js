"use strict";(self.webpackChunkkotestdocs=self.webpackChunkkotestdocs||[]).push([[32091],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>m});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),g=c(a),m=i,k=g["".concat(s,".").concat(m)]||g[m]||u[m]||o;return a?n.createElement(k,l(l({ref:t},p),{},{components:a})):n.createElement(k,l({ref:t},p))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,l=new Array(o);l[0]=g;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:i,l[1]=r;for(var c=2;c<o;c++)l[c]=a[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},87452:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var n=a(87462),i=(a(67294),a(3905));const o={id:"package_level_config",title:"Package Level Config",slug:"package-level-config.html"},l="Package Level Config",r={unversionedId:"framework/package_level_config",id:"framework/package_level_config",title:"Package Level Config",description:"This page describes how to use package-level configuration to share configuration across multiple specs in the same",source:"@site/docs/framework/package_level_config.md",sourceDirName:"framework",slug:"/framework/package-level-config.html",permalink:"/docs/next/framework/package-level-config.html",draft:!1,editUrl:"https://github.com/kotest/kotest/blob/master/documentation/docs/framework/package_level_config.md",tags:[],version:"current",frontMatter:{id:"package_level_config",title:"Package Level Config",slug:"package-level-config.html"},sidebar:"framework",previous:{title:"Project Level Config",permalink:"/docs/next/framework/project-config.html"},next:{title:"Shared Test Config",permalink:"/docs/next/framework/sharedtestconfig.html"}},s={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Configuration Resolution Order",id:"configuration-resolution-order",level:2},{value:"Available Configuration Options",id:"available-configuration-options",level:2},{value:"Examples",id:"examples",level:2},{value:"Example: Setting Timeouts and Retries",id:"example-setting-timeouts-and-retries",level:3},{value:"Example: Configuring Test Execution Mode",id:"example-configuring-test-execution-mode",level:3},{value:"Example: Adding Extensions for a Package",id:"example-adding-extensions-for-a-package",level:3},{value:"Package Hierarchy",id:"package-hierarchy",level:2},{value:"Implementation Details",id:"implementation-details",level:2}],p={toc:c};function u(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"package-level-config"},"Package Level Config"),(0,i.kt)("p",null,"This page describes how to use package-level configuration to share configuration across multiple specs in the same\npackage."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Package-level configuration was introduced in Kotest 6.0. If you are using an earlier version, please upgrade to\ntake advantage of this feature.")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Package-level configuration is a JVM only feature.")),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"When writing tests, you often need to apply the same configuration to multiple test files in the same package.\nInstead of repeating the same configuration for each spec, or setting it at the global project level, you can use\npackage-level configuration to define a shared configuration that applies to all specs in a specific package and its\nsub-packages."),(0,i.kt)("p",null,"Package-level configuration works by creating a class named ",(0,i.kt)("inlineCode",{parentName:"p"},"PackageConfig")," that extends ",(0,i.kt)("inlineCode",{parentName:"p"},"AbstractPackageConfig")," in the\npackage where you want to apply the configuration."),(0,i.kt)("h2",{id:"basic-usage"},"Basic Usage"),(0,i.kt)("p",null,"To set a default configuration for all specs in a package, create a class named ",(0,i.kt)("inlineCode",{parentName:"p"},"PackageConfig")," that extends\n",(0,i.kt)("inlineCode",{parentName:"p"},"AbstractPackageConfig")," in the target package:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},"// In package: com.example.mypackage\nclass PackageConfig : AbstractPackageConfig() {\n  override val timeout = 5.seconds\n  override val invocations = 2\n  override val failfast = true\n}\n")),(0,i.kt)("p",null,"With this configuration:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"All tests in specs within the ",(0,i.kt)("inlineCode",{parentName:"li"},"com.example.mypackage")," package will have a timeout of 5 seconds"),(0,i.kt)("li",{parentName:"ul"},"All tests will run twice (2 invocations)"),(0,i.kt)("li",{parentName:"ul"},"Tests will use failfast mode")),(0,i.kt)("p",null,"This configuration will also apply to all sub-packages (e.g., ",(0,i.kt)("inlineCode",{parentName:"p"},"com.example.mypackage.subpackage"),")."),(0,i.kt)("h2",{id:"configuration-resolution-order"},"Configuration Resolution Order"),(0,i.kt)("p",null,"Kotest uses the following order to resolve configuration values:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Test-specific configuration (set via ",(0,i.kt)("inlineCode",{parentName:"li"},".config()"),")"),(0,i.kt)("li",{parentName:"ol"},"Spec-level overrides (set via variables in the spec class)"),(0,i.kt)("li",{parentName:"ol"},"Spec-level default configuration (set via ",(0,i.kt)("inlineCode",{parentName:"li"},"defaultTestConfig"),")"),(0,i.kt)("li",{parentName:"ol"},"Package-level configuration (set via ",(0,i.kt)("inlineCode",{parentName:"li"},"PackageConfig"),")"),(0,i.kt)("li",{parentName:"ol"},"Parent package configuration (if any)"),(0,i.kt)("li",{parentName:"ol"},"Global configuration (set via ",(0,i.kt)("inlineCode",{parentName:"li"},"ProjectConfig"),")"),(0,i.kt)("li",{parentName:"ol"},"System properties or environment variables")),(0,i.kt)("p",null,"This means that more specific configurations will override more general ones. For example, if you set a timeout at both\nthe test level and in a package-level config, the test-level timeout will be used."),(0,i.kt)("h2",{id:"available-configuration-options"},"Available Configuration Options"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"AbstractPackageConfig")," supports the following configuration options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"isolationMode"),": Controls how tests are isolated from each other"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"assertionMode"),": Controls how assertions behave"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"testCaseOrder"),": Controls the order in which tests are executed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"timeout"),": Maximum time a test is allowed to run"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"invocationTimeout"),": Maximum time each individual invocation is allowed to run"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"failfast"),": Whether to fail fast on the first failure"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"retries"),": Number of times to retry a failing test"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"coroutineDebugProbes"),": Whether to enable enhanced tracing of coroutines when an error occurs"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"coroutineTestScope"),": Whether to use a coroutine test scope"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duplicateTestNameMode"),": Controls what to do when a duplicated test name is discovered"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"assertSoftly"),": Whether to use soft assertions for all tests"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"testExecutionMode"),": Controls how tests are executed (sequentially or concurrently)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"extensions"),": List of extensions to apply to all tests in the package")),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("h3",{id:"example-setting-timeouts-and-retries"},"Example: Setting Timeouts and Retries"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},"// In package: com.example.api.tests\nclass PackageConfig : AbstractPackageConfig() {\n  // All API tests might need longer timeouts and retries\n  override val timeout = 30.seconds\n  override val retries = 3\n}\n")),(0,i.kt)("h3",{id:"example-configuring-test-execution-mode"},"Example: Configuring Test Execution Mode"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},"// In package: com.example.unit.tests\nclass PackageConfig : AbstractPackageConfig() {\n  // Run all unit tests concurrently for faster execution\n  override val testExecutionMode = TestExecutionMode.Concurrent\n}\n")),(0,i.kt)("h3",{id:"example-adding-extensions-for-a-package"},"Example: Adding Extensions for a Package"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},'// In package: com.example.database.tests\nclass PackageConfig : AbstractPackageConfig() {\n  // Add a database container for all database tests\n  override val extensions = listOf(\n    ContainerExtension(PostgreSQLContainer<Nothing>().withDatabaseName("testdb"))\n  )\n}\n')),(0,i.kt)("h2",{id:"package-hierarchy"},"Package Hierarchy"),(0,i.kt)("p",null,"When you have package-level configurations at different levels of your package hierarchy, the configuration closest to\nthe spec's package takes precedence."),(0,i.kt)("p",null,"For example, if you have:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"com.example.PackageConfig\ncom.example.api.PackageConfig\ncom.example.api.v1.PackageConfig\n")),(0,i.kt)("p",null,"And your test is in ",(0,i.kt)("inlineCode",{parentName:"p"},"com.example.api.v1.UserTest"),", then:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"com.example.api.v1.PackageConfig")," will be applied first"),(0,i.kt)("li",{parentName:"ol"},"Any values not set there will fall back to ",(0,i.kt)("inlineCode",{parentName:"li"},"com.example.api.PackageConfig")),(0,i.kt)("li",{parentName:"ol"},"Any values not set in either will fall back to ",(0,i.kt)("inlineCode",{parentName:"li"},"com.example.PackageConfig")),(0,i.kt)("li",{parentName:"ol"},"Finally, any values not set in any package config will fall back to the project config")),(0,i.kt)("h2",{id:"implementation-details"},"Implementation Details"),(0,i.kt)("p",null,"Kotest automatically detects classes named ",(0,i.kt)("inlineCode",{parentName:"p"},"PackageConfig")," that extend ",(0,i.kt)("inlineCode",{parentName:"p"},"AbstractPackageConfig")," at runtime. The detection\nhappens when a test is executed, and Kotest looks for package configs in the package of the test and all parent\npackages."),(0,i.kt)("p",null,"For performance reasons, package configs are cached after they are first loaded, so changes to a package config class\nwill only take effect after restarting the test run."))}u.isMDXComponent=!0}}]);