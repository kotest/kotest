"use strict";(self.webpackChunkkotestdocs=self.webpackChunkkotestdocs||[]).push([[89645],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=c(n),d=o,f=m["".concat(s,".").concat(d)]||m[d]||p[d]||i;return n?a.createElement(f,r(r({ref:t},u),{},{components:n})):a.createElement(f,r({ref:t},u))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},29020:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const i={id:"mountables",title:"Mountables",slug:"mountables.html",sidebar_label:"Mountables"},r=void 0,l={unversionedId:"framework/extensions/mountables",id:"framework/extensions/mountables",title:"Mountables",description:"Mountables are a special type of extension that can be installed in a spec, returning what is called a materialized",source:"@site/docs/framework/extensions/mountables.md",sourceDirName:"framework/extensions",slug:"/framework/extensions/mountables.html",permalink:"/docs/next/framework/extensions/mountables.html",draft:!1,editUrl:"https://github.com/kotest/kotest/blob/master/documentation/docs/framework/extensions/mountables.md",tags:[],version:"current",frontMatter:{id:"mountables",title:"Mountables",slug:"mountables.html",sidebar_label:"Mountables"},sidebar:"framework",previous:{title:"Examples",permalink:"/docs/next/framework/extensions/extension-examples.html"},next:{title:"Test Coroutine Dispatcher",permalink:"/docs/next/framework/coroutines/test-coroutine-dispatcher.html"}},s={},c=[{value:"Creating a Mountable",id:"creating-a-mountable",level:2},{value:"Example",id:"example",level:2}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Mountables are a special type of extension that can be installed in a spec, returning what is called a materialized\nvalue to the caller. This allows these extensions to return control objects which differ from the extension itself. The\nmountable can be customized as it is created through an optional configuration\nblock."),(0,o.kt)("p",null,"Mountables are installed using the ",(0,o.kt)("inlineCode",{parentName:"p"},"install")," function at the top level of a spec."),(0,o.kt)("p",null,"For example, we could imagine a Kafka extension that returns a Kafka client once installed."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"class MyExampleTest : FunSpec() {\n  init {\n    val kafka = install(EmbeddedKafka) {\n      port = 9092\n    }\n  }\n}\n")),(0,o.kt)("p",null,"Here ",(0,o.kt)("inlineCode",{parentName:"p"},"kafka")," would be the materialized value and in this example, it could be a Kafka consumer connected to the\nembedded Kafka instance. The configuration block is used to configure the extension, and ",(0,o.kt)("inlineCode",{parentName:"p"},"EmbeddedKafka")," is the\nextension itself."),(0,o.kt)("p",null,"Mountables can of course return the extension itself if they don't need a separate object, or return Unit."),(0,o.kt)("p",null,"Another example of a mountable is the JDBC Test Container extension, which returns a JDBC connection pool as the\nmaterialized value. This makes using test containers in Kotest very convenient."),(0,o.kt)("h2",{id:"creating-a-mountable"},"Creating a Mountable"),(0,o.kt)("p",null,"Implement the ",(0,o.kt)("inlineCode",{parentName:"p"},"MountableExtension")," interface and additionally implement any other lifecycle methods you need. This is\nanother powerful feature of mountables, as it allows your extension to hook into other lifecycle events. For example,\nyour mountable instance can itself implement ",(0,o.kt)("inlineCode",{parentName:"p"},"AfterSpec")," and then the ",(0,o.kt)("inlineCode",{parentName:"p"},"afterSpec")," method of the mountable will be called\nafter the spec has finished running."),(0,o.kt)("p",null,"The interface has two type parameters: the config type and the materialized value type. The latter is the type that is\nreturned to the caller, and as mentioned previously, it can be the same as the extension itself. The config type is\npassed as a receiver object to the configuration block. So this is where you define values or methods you want callers\nto be able to assign or invoke."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"One drawback is that the configuration block is not suspendable, due to the fact that the init block is not itself\nsuspendable. To work around this, you can use runBlocking { } inside your implementation.")),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("p",null,"Lets create a mountable that installs a H2 embedded database. The materialized value will be a connection to the\ndatabase instance. We will allow the user to configure some details of the database in a configuration\nblock. We will also implement ",(0,o.kt)("inlineCode",{parentName:"p"},"AfterSpec")," so that the database is closed after the spec has finished running."),(0,o.kt)("p",null,"First we create the configuration class that contains our customization options."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'class H2Config {\n   var databaseName = "test"\n}\n')),(0,o.kt)("p",null,"Now we make the mountable extension, also implementing ",(0,o.kt)("inlineCode",{parentName:"p"},"AfterSpec")," so we can close the connection after the spec has\nfinished running. Notice that we use the ",(0,o.kt)("inlineCode",{parentName:"p"},"mount")," function to perform the installation logic, and this function\nreturns the materialized value - in this case, a JDBC connection to the database."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'class H2DatabaseMountableExtension() : MountableExtension<H2Config, Connection>, AfterSpecListener {\n\n   var conn: Connection? = null\n\n   override fun mount(configure: H2Config.() -> Unit): Connection {\n      val config = H2Config()\n      config.configure()\n      conn = DriverManager.getConnection("jdbc:h2:~/${config.databaseName}")\n      return conn!!\n   }\n\n   override suspend fun afterSpec(spec: Spec) {\n      conn?.close()\n   }\n}\n')))}p.isMDXComponent=!0}}]);