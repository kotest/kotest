"use strict";(self.webpackChunkkotestdocs=self.webpackChunkkotestdocs||[]).push([[70304],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var s=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,s,a=function(e,t){if(null==e)return{};var n,s,a={},l=Object.keys(e);for(s=0;s<l.length;s++)n=l[s],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(s=0;s<l.length;s++)n=l[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=s.createContext({}),u=function(e){var t=s.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return s.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},d=s.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,h=d["".concat(i,".").concat(m)]||d[m]||c[m]||l;return n?s.createElement(h,o(o({ref:t},p),{},{components:n})):s.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=d;var r={};for(var i in t)hasOwnProperty.call(t,i)&&(r[i]=t[i]);r.originalType=e,r.mdxType="string"==typeof e?e:a,o[1]=r;for(var u=2;u<l;u++)o[u]=n[u];return s.createElement.apply(null,o)}return s.createElement.apply(null,n)}d.displayName="MDXCreateElement"},11470:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>r,toc:()=>u});var s=n(87462),a=(n(67294),n(3905));const l={title:"Clues",slug:"clues.html"},o=void 0,r={unversionedId:"assertions/clues",id:"version-5.5.x/assertions/clues",title:"Clues",description:"Clues only work if you are using the Kotest assertions library or Kotest test framework",source:"@site/versioned_docs/version-5.5.x/assertions/clues.md",sourceDirName:"assertions",slug:"/assertions/clues.html",permalink:"/docs/5.5.x/assertions/clues.html",draft:!1,editUrl:"https://github.com/kotest/kotest/blob/master/documentation/versioned_docs/version-5.5.x/assertions/clues.md",tags:[],version:"5.5.x",frontMatter:{title:"Clues",slug:"clues.html"},sidebar:"assertions",previous:{title:"Exceptions",permalink:"/docs/5.5.x/assertions/exceptions.html"},next:{title:"Soft Assertions",permalink:"/docs/5.5.x/assertions/soft-assertions.html"}},i={},u=[{value:"Nested clues",id:"nested-clues",level:2}],p={toc:u};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,s.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Clues only work if you are using the Kotest assertions library or Kotest test framework")),(0,a.kt)("p",null,"A rule of thumb is that a failing test should look like a good bug report.\nIn other words, it should tell you what went wrong, and ideally why it went wrong."),(0,a.kt)("p",null,"Sometimes a failed assertion contains enough information in the error message to know what went wrong."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'username shouldBe "sksamuel"\n')),(0,a.kt)("p",null,"Might give an error like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'expected: "sksamuel" but was: "sam@myemailaddress.com"\n')),(0,a.kt)("p",null,"In this case, it looks like the system populates the username field with an email address."),(0,a.kt)("p",null,"But let's say you had a test like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"user.name shouldNotBe null\n")),(0,a.kt)("p",null,"If this failed, you would simply get:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"<null> should not equal <null>\n")),(0,a.kt)("p",null,"Which isn't particularly helpful. This is where ",(0,a.kt)("inlineCode",{parentName:"p"},"withClue")," comes into play."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"withClue")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"asClue")," helpers can add extra context to assertions so failures are self explanatory:"),(0,a.kt)("p",null,"For example, we can use ",(0,a.kt)("inlineCode",{parentName:"p"},"withClue")," with a string message"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'withClue("Name should be present") {\n  user.name shouldNotBe null\n}\n')),(0,a.kt)("p",null,"Would give an error like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Name should be present\n<null> should not equal <null>\n")),(0,a.kt)("p",null,"The error message became much better, however, it is still not as good as it could be.\nFor instance, it might be helpful to know the user's id to check the database."),(0,a.kt)("p",null,"We can use ",(0,a.kt)("inlineCode",{parentName:"p"},"withClue")," to add the user's id to the error message:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'withClue({ "Name should be present (user_id=${user.id})" }) {\n  user.name shouldNotBe null\n}\n')),(0,a.kt)("p",null,"We can also use the ",(0,a.kt)("inlineCode",{parentName:"p"},"asClue")," extension function to turn any object into the clue message."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'{ "Name should be present (user_id=${user.id})" }.asClue {\nuser.name shouldNotBe null\n}\n')),(0,a.kt)("p",null,"The message will be computed only in case the test fails, so it is safe to use it with expensive operations."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Test failures include a failed assertion, test name, clues, and stacktrace.\nConsider using them in such a way, so they answer both what has failed, and why it failed.\nIt will make the tests easier to maintain, especially when it comes to reverse-engineering the intention of the test author.")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Every time you see a code comment above an assertion, consider using ",(0,a.kt)("inlineCode",{parentName:"p"},"asClue"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"withClue")," instead.\nThe comments are not visible in the test failures, especially on CI, while clues will be visible.")),(0,a.kt)("p",null,"You can use domain objects as clues as well:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'data class HttpResponse(val status: Int, val body: String)\n\nval response = HttpResponse(404, "the content")\n\nresponse.asClue {\n    it.status shouldBe 200\n    it.body shouldBe "the content"\n}\n')),(0,a.kt)("p",null,"Would output:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"HttpResponse(status=404, body=the content)\nExpected :200\nActual   :404\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Kotest considers all ",(0,a.kt)("inlineCode",{parentName:"p"},"() -> Any?")," clues as lazy clues, and would compute them and use ",(0,a.kt)("inlineCode",{parentName:"p"},".toString()")," on the resulting value\ninstead of calling ",(0,a.kt)("inlineCode",{parentName:"p"},".toString()")," on the function itself.\nIn most cases, it should do exactly what you need, however, if clue object implements ",(0,a.kt)("inlineCode",{parentName:"p"},"() -> Any?"),", and you want\nusing ",(0,a.kt)("inlineCode",{parentName:"p"},"clue.toString()"),", then consider wrapping the clue manually as ",(0,a.kt)("inlineCode",{parentName:"p"},"{ clue.toString() }.asClue { ... }"),".")),(0,a.kt)("h2",{id:"nested-clues"},"Nested clues"),(0,a.kt)("p",null,"Clues can be nested, and they all will be visible in the failed assertion messages:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'{ "Verifying user_id=${user.name}" }.asClue {\n  "email_confirmed should be false since we\'ve just created the user".asClue {\n    user.emailConfirmed shouldBe false\n  }\n  "login".asClue {\n    user.login shouldBe "sksamuel"\n  }\n}\n')),(0,a.kt)("p",null,"The failure might look like"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Verifying user_id=42\nemail_confirmed should be false since we've just created the user\n<true> should equal <false>\n")))}c.isMDXComponent=!0}}]);