"use strict";(self.webpackChunkkotestdocs=self.webpackChunkkotestdocs||[]).push([[5977],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),g=p(n),m=r,c=g["".concat(o,".").concat(m)]||g[m]||u[m]||i;return n?a.createElement(c,s(s({ref:t},d),{},{components:n})):a.createElement(c,s({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=g;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<i;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},44606:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const i={id:"tags",title:"Grouping Tests with Tags",slug:"tags.html",sidebar_label:"Grouping Tests"},s=void 0,l={unversionedId:"framework/tags",id:"version-6.1/framework/tags",title:"Grouping Tests with Tags",description:"Sometimes you don't want to run all tests and Kotest provides tags to be able to determine which",source:"@site/versioned_docs/version-6.1/framework/tags.md",sourceDirName:"framework",slug:"/framework/tags.html",permalink:"/docs/framework/tags.html",draft:!1,editUrl:"https://github.com/kotest/kotest/blob/master/documentation/versioned_docs/version-6.1/framework/tags.md",tags:[],version:"6.1",frontMatter:{id:"tags",title:"Grouping Tests with Tags",slug:"tags.html",sidebar_label:"Grouping Tests"},sidebar:"framework",previous:{title:"Test Ordering",permalink:"/docs/framework/test-ordering.html"},next:{title:"Closing resources automatically",permalink:"/docs/framework/autoclose.html"}},o={},p=[{value:"Adding tags to tests",id:"adding-tags-to-tests",level:2},{value:"Tagging Tests",id:"tagging-tests",level:3},{value:"Tagging Specs",id:"tagging-specs",level:3},{value:"@RequiresTag",id:"requirestag",level:3},{value:"Executing with Tags",id:"executing-with-tags",level:2},{value:"Tag Expression Operators",id:"tag-expression-operators",level:3},{value:"Inheriting tags",id:"inheriting-tags",level:3},{value:"Examples",id:"examples",level:2},{value:"Gradle",id:"gradle",level:2}],d={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Sometimes you don't want to run all tests and Kotest provides ",(0,r.kt)("inlineCode",{parentName:"p"},"tags")," to be able to determine which\ntests are executed at runtime. Tags are objects inheriting from ",(0,r.kt)("inlineCode",{parentName:"p"},"io.kotest.core.Tag"),"."),(0,r.kt)("p",null,"For example, to group tests by operating system you could define the following tags:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"object Linux : Tag()\nobject Windows : Tag()\n")),(0,r.kt)("p",null,"Alternatively, tags can be defined using the ",(0,r.kt)("inlineCode",{parentName:"p"},"NamedTag")," class. When using this class, observe the following rules:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A tag must not be null or blank."),(0,r.kt)("li",{parentName:"ul"},"A tag must not contain whitespace."),(0,r.kt)("li",{parentName:"ul"},"A tag must not contain ISO control characters."),(0,r.kt)("li",{parentName:"ul"},"A tag must not contain any of the following characters:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"!: exclamation mark"),(0,r.kt)("li",{parentName:"ul"},"(: left paren"),(0,r.kt)("li",{parentName:"ul"},"): right paren"),(0,r.kt)("li",{parentName:"ul"},"&: ampersand"),(0,r.kt)("li",{parentName:"ul"},"|: pipe")))),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'val tag = NamedTag("Linux")\n')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If two tag objects have the same simple name (even in different packages) they are treated as the same tag.")),(0,r.kt)("h2",{id:"adding-tags-to-tests"},"Adding tags to tests"),(0,r.kt)("h3",{id:"tagging-tests"},"Tagging Tests"),(0,r.kt)("p",null,"Tests can be tagged at various levels. Firstly, test cases themselves can have tags added via test ",(0,r.kt)("inlineCode",{parentName:"p"},"config"),".\nNote that any nested tags inherit tags from their parents."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MyTest : FunSpec() {\n  init {\n    test("should run on Windows").config(tags = setOf(Windows)) {\n      // ...\n    }\n\n    test("should run on Linux").config(tags = setOf(Linux)) {\n      // ...\n    }\n\n    context("should run on Windows and Linux").config(tags = setOf(Windows, Linux)) {\n      test("and nested tests") { // implicity has windows and linux tags added\n\n      }\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"tagging-specs"},"Tagging Specs"),(0,r.kt)("p",null,"Secondly, you can add tags at the spec level, either through the tags function in the spec itself, or through the @Tags\nannotation. Any tags\nadded this way are applied to all tests implicitly."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"When tagging tests in this way, the spec class will still need to be instantiated in order to examine the tags on each\ntest, because the test itself may define further tags. Therefore, do not rely on this if you want to avoid instantiating\nclasses completely, and instead see @RequiresTag.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'@Tags("Foo") // applied to all tests in this spec\nprivate class TaggedSpec : ExpectSpec() {\n  init {\n\n    tags(Windows) // applied to all tests in this spec\n\n    expect("should run on Windows") {\n      // ...\n    }\n  }\n}\n')),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Any tags added via @Tags do not stop the spec from being instantiated, as the engine\nneeds to check for any tags added via code. If you want to avoid a spec from being instantiated completely, use\n@RequiresTag.")),(0,r.kt)("h3",{id:"requirestag"},"@RequiresTag"),(0,r.kt)("p",null,"Finally, you can use the @RequiresTag annotation. This only checks that all the referenced tags are present and\nif not, will skip the spec entirely. This is an important distinction, because with the other annotation - @Tags - the\nspec will still need to be instantiated in order to check for any tags added via the DSL. This can be counter-intuitive."),(0,r.kt)("p",null,"For example, the following spec would be skipped and not instantiated unless the Linux and Mysql tags were\nspecified at runtime."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'@RequiresTag("Linux", "Mysql")\nclass MyTestClass : FunSpec()\n')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Note that when you use annotations you pass the string name of the tag, not the tag instance itself.")),(0,r.kt)("h2",{id:"executing-with-tags"},"Executing with Tags"),(0,r.kt)("p",null,"By invoking the test runner with a system property of ",(0,r.kt)("inlineCode",{parentName:"p"},"kotest.tags")," or an environment variable of ",(0,r.kt)("inlineCode",{parentName:"p"},"KOTEST_TAGS")," you can\ncontrol which tests are run. The expression to be passed in is a simple boolean expression using boolean operators: ",(0,r.kt)("inlineCode",{parentName:"p"},"&"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"|"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"!"),", with parenthesis for association."),(0,r.kt)("p",null,"For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"Tag1 & (Tag2 | Tag3)")),(0,r.kt)("p",null,"Provide the simple names of tag object (without package) when you run the tests. Eg, a tag created as\n",(0,r.kt)("inlineCode",{parentName:"p"},'val mytag = NamedTag("A")')," would use the tag name ",(0,r.kt)("inlineCode",{parentName:"p"},"A"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Please pay attention to the use of upper case and lower case! Tags are case-sensitive.")),(0,r.kt)("p",null,"Example: To run only test tagged with ",(0,r.kt)("inlineCode",{parentName:"p"},"Linux"),", but not tagged with ",(0,r.kt)("inlineCode",{parentName:"p"},"Database"),", you would invoke Gradle\nusing the environment variable (since Kotest 6.1.0)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'KOTEST_TAGS="Linux & !Database" gradle check\n')),(0,r.kt)("p",null,"Or using the system property from the command line."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'gradle test -Dkotest.tags="Linux & !Database"\n')),(0,r.kt)("p",null,"Or by specifying the system property inside your build script."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'tasks.withType<Test>().configureEach {\n  systemProperty("kotest.tags", "Linux & !Database")\n}\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Prefer the environment variable as it works on all platforms, unless you are on an earlier version of Kotest\n(prior to 6.1), or need to specify the tags in your Gradle build script rather than at the command line.")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If no root tests are active at runtime, the ",(0,r.kt)("a",{parentName:"p",href:"/docs/framework/lifecycle-hooks.html"},"beforeSpec")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/framework/lifecycle-hooks.html"},"afterSpec"),"\ncallbacks will ",(0,r.kt)("em",{parentName:"p"},"not")," be invoked.")),(0,r.kt)("h3",{id:"tag-expression-operators"},"Tag Expression Operators"),(0,r.kt)("p",null,"Operators (in descending order of precedence)"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Operator"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"!"),(0,r.kt)("td",{parentName:"tr",align:null},"not"),(0,r.kt)("td",{parentName:"tr",align:null},"!macos")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"&"),(0,r.kt)("td",{parentName:"tr",align:null},"and"),(0,r.kt)("td",{parentName:"tr",align:null},"linux & integration")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"|"),(0,r.kt)("td",{parentName:"tr",align:null},"or"),(0,r.kt)("td",{parentName:"tr",align:null},"windows ","|"," microservice")))),(0,r.kt)("h3",{id:"inheriting-tags"},"Inheriting tags"),(0,r.kt)("p",null,"By default, the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Tags")," annotation will only be considered on the immediate Spec which it was applied to. However, a\nSpec can also inherit tags from superclasses and superinterfaces. To enable this, toggle ",(0,r.kt)("inlineCode",{parentName:"p"},"tagInheritance = true")," in\nyour ",(0,r.kt)("a",{parentName:"p",href:"/docs/framework/project-config.html"},"project config")),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("p",null,"Consider the following example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'@Tags("Linux")\nclass MyTestClass : FunSpec({\n\n  tags(UnitTest)\n\n  beforeSpec { println("Before") }\n\n  test("A").config(tags = setOf(Mysql)) {}\n  test("B").config(tags = setOf(Postgres)) {}\n  test("C") {}\n})\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Runtime Tags"),(0,r.kt)("th",{parentName:"tr",align:null},"Spec Created"),(0,r.kt)("th",{parentName:"tr",align:null},"Callbacks"),(0,r.kt)("th",{parentName:"tr",align:null},"Outcome"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kotest.tags=Linux"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"A, B, C are executed because all tests inherit the ",(0,r.kt)("inlineCode",{parentName:"td"},"Linux")," tag from the annotation")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kotest.tags=Linux & Mysql"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"A is executed only because all tests have the ",(0,r.kt)("inlineCode",{parentName:"td"},"Linux")," tag, but only A has the ",(0,r.kt)("inlineCode",{parentName:"td"},"Mysql")," tag")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kotest.tags=!Linux"),(0,r.kt)("td",{parentName:"tr",align:null},"no"),(0,r.kt)("td",{parentName:"tr",align:null},"no"),(0,r.kt)("td",{parentName:"tr",align:null},"No tests are executed, and the MyTestClass is not instantiated because we can exclude it based on the tags annotation")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kotest.tags=!UnitTest"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"no"),(0,r.kt)("td",{parentName:"tr",align:null},"No tests are executed because all tests inherit ",(0,r.kt)("inlineCode",{parentName:"td"},"UnitTest")," from the tags function. MyTestClass is instantiated in order to retrieve the tags defined in the class. The beforeSpec callback is not executed because there are no active tests.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kotest.tags=Mysql"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"A is executed only, because that is the only test marked with ",(0,r.kt)("inlineCode",{parentName:"td"},"Mysql"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kotest.tags=!Mysql"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"B, C are executed only, because A is excluded by being marked with ",(0,r.kt)("inlineCode",{parentName:"td"},"Mysql"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kotest.tags=Linux & !Mysql"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"B, C are executed only, because all tests inherit ",(0,r.kt)("inlineCode",{parentName:"td"},"Linux")," from the annotation, but A is excluded by the ",(0,r.kt)("inlineCode",{parentName:"td"},"Mysql")," tag")))),(0,r.kt)("h2",{id:"gradle"},"Gradle"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Special attention is needed in your Gradle configuration when using system properties")),(0,r.kt)("p",null,"To use System Properties (-Dx=y), Gradle must be configured to propagate them to the test executors, and an extra\nconfiguration must be added to your tests:"),(0,r.kt)("p",null,"Groovy:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-groovy"},"test {\n  //... Other configurations ...\n  systemProperties = System.properties\n}\n")),(0,r.kt)("p",null,"Kotlin Gradle DSL:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"val test by tasks.getting(Test::class) {\n  // ... Other configurations ...\n  systemProperties = System.getProperties().asIterable().associate { it.key.toString() to it.value }\n}\n")),(0,r.kt)("p",null,"This will guarantee that the system property is correctly read by the JVM."))}u.isMDXComponent=!0}}]);